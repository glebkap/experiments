# Алгоритм поиска дверей и окон на планах зданий

## Общее описание

Алгоритм предназначен для обнаружения, маркировки и подсчета дверей и окон на планах зданий с использованием методов компьютерного зрения. Алгоритм построен на основе комбинации методов обнаружения и сопоставления признаков (ORB) и шаблонного сопоставления.

## Этапы алгоритма

### 1. Предварительная обработка входного изображения

- Загрузка изображения плана здания в формате JPG или PNG
- Преобразование в оттенки серого для упрощения последующей обработки
- Устранение шума с использованием Гауссова размытия
- Улучшение контрастности для более четкого выделения элементов
- Бинаризация изображения для выделения контуров

### 2. Подготовка эталонных образцов

- Загрузка и предобработка эталонных изображений дверей из директории `data/doors`
- Загрузка и предобработка эталонных изображений окон из директории `data/windows`
- Нормализация размеров и форматов эталонных изображений
- Извлечение ключевых характеристик эталонных объектов для последующего сравнения

### 3. Поиск объектов на изображении

#### Метод 1: Обнаружение признаков с использованием ORB

- Использование алгоритма ORB (Oriented FAST and Rotated BRIEF) для обнаружения ключевых точек и их дескрипторов
- Сопоставление дескрипторов между эталонными образцами и планом здания с использованием KNN (k-ближайших соседей)
- Применение теста отношения Лоу (Lowe's ratio test) для фильтрации соответствий
- Фильтрация соответствий и применение порога для определения хороших соответствий
- Оценка геометрического преобразования (гомография) между эталоном и найденной областью
- Вычисление ограничивающего прямоугольника для каждого обнаруженного объекта
- **Преимущество**: инвариантность к повороту, что позволяет обнаруживать окна и двери независимо от их ориентации

#### Метод 2: Шаблонное сопоставление (Template Matching)

- Применение алгоритма `cv2.matchTemplate` для каждого эталонного образца
- Использование метрики нормализованной кросс-корреляции для сопоставления
- Установка порога соответствия для фильтрации результатов
- Обработка пересекающихся обнаружений с помощью алгоритма подавления немаксимумов (NMS)

### 4. Постобработка и уточнение результатов

- Объединение результатов, полученных разными методами
- Устранение дублирующих обнаружений с использованием алгоритма NMS
- Фильтрация обнаружений по уровню уверенности (confidence)

### 5. Маркировка и классификация объектов

- Визуализация результатов на исходном изображении плана:
  - Обозначение дверей красным цветом
  - Обозначение окон синим цветом
- Присвоение уникальных идентификаторов каждому обнаруженному объекту
- Добавление меток с типом объекта (дверь/окно)

### 6. Формирование отчета

- Подсчет общего количества обнаруженных дверей
- Подсчет общего количества обнаруженных окон
- Сохранение размеченного изображения с выделенными объектами
- Вывод статистики по обнаруженным объектам

## Особенности реализации

- Использование библиотеки OpenCV для обработки изображений
- Реализация с учетом архитектурных принципов, описанных в документации проекта
- Разделение на доменные слои и usecase в соответствии с принятой структурой
- Учет требований по производительности (обработка одного изображения не более 10 секунд)
- Обеспечение точности распознавания не менее 90%
- Обеспечение инвариантности к повороту для обнаружения объектов в различных ориентациях

## Параметры алгоритма ORB

- `orb_features` - максимальное количество ключевых точек для обнаружения (по умолчанию 1000)
- `orb_scale_factor` - коэффициент масштабирования пирамиды (по умолчанию 1.2)
- `orb_levels` - количество уровней пирамиды (по умолчанию 8)
- `orb_min_matches` - минимальное количество хороших соответствий для подтверждения объекта (по умолчанию 10)
- `orb_match_ratio` - пороговое отношение для теста Лоу при KNN-сопоставлении (по умолчанию 0.75)

## Возможные улучшения

- Применение методов машинного обучения для повышения точности распознавания
- Оптимизация алгоритмов для ускорения обработки больших планов
- Добавление возможности распознавания других архитектурных элементов
- Реализация пакетной обработки нескольких планов
- Использование других алгоритмов, инвариантных к повороту (SIFT, SURF)
